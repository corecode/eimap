;;; -*- mode: emacs-lisp; -*-

;;; REQUIREMENTS

; (package-install 'dash)

;;; USAGE TEASER

(add-to-list 'load-path default-directory)

(require 'eimap)
(with-current-buffer (eimap-open "0x2c.org" :user "2") ; connects via IMAPS/993
  (split-window-vertically)
  (switch-to-buffer (current-buffer))

  ;; XXX need to figure out how to do the callbacks
  (while (not (eq eimap-state :authenticated))
    (sleep-for 1))
  (eimap-request '(:method SELECT :mailbox "INBOX"))
  (eimap-request '(:method FETCH :ids (:from 1 :to 4) :attr FAST))
  (let* ((query '((NOT . DELETED)))
         (req `(:method SEARCH :keys ,query)))
    (when (member "ESEARCH" eimap-capabilities)
      (setq req (plist-put req :return 'ALL)))
    (eimap-request req
                   :cbdata "foo"
                   :done (lambda (data cbdata)
                           (message "callback data %s cbdata %s"
                                    (pp-to-string data)
                                    (pp-to-string cbdata))))))

;; check out (switch-to-buffer-other-window "*Messages*")
;; that's where all the parsed data arrived
